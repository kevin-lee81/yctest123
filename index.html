<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVCì¹´ë“œ ì œì¡° - ì£¼ë¬¸ì œì‘ ì „ë¬¸</title>
    <style>
        /* CSS ì½”ë“œëŠ” ì œê³µí•´ì£¼ì‹  ì›ë³¸ê³¼ ë™ì¼í•©ë‹ˆë‹¤ (ìƒëµ) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255, 255, 255, 0.95); padding: 20px 0; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); }
        .header h1 { text-align: center; color: #2c3e50; font-size: 2.5em; margin-bottom: 10px; }
        .header p { text-align: center; color: #7f8c8d; font-size: 1.2em; }
        .nav-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .btn { padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
        .btn-primary { background: linear-gradient(45deg, #3498db, #2980b9); color: white; }
        .btn-secondary { background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; }
        .btn-success { background: linear-gradient(45deg, #27ae60, #229954); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        .content { background: rgba(255, 255, 255, 0.95); padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 16px; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #3498db; }
        .hidden { display: none; }
        .business-fields { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 15px; border: 1px solid #e9ecef; }
        .status-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: white; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        .status-badge { padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; color: white; }
        .status-pending { background: #f39c12; } .status-processing { background: #3498db; } .status-shipping { background: #9b59b6; } .status-completed { background: #27ae60; }
        .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .file-upload-notice { background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffeaa7; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; color: white; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) { .grid-2 { grid-template-columns: 1fr; } .header h1 { font-size: 2em; } .content { padding: 20px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ·ï¸ PVCì¹´ë“œ ì£¼ë¬¸ì œì‘</h1>
            <p>í”„ë¦¬ë¯¸ì—„ PVCì¹´ë“œ ì „ë¬¸ì—…ì²´</p>
            <div id="nav-guest" class="nav-buttons">
                <button class="btn btn-primary" onclick="showSection('home')">í™ˆ</button>
                <button class="btn btn-secondary" onclick="showSection('login')">ë¡œê·¸ì¸</button>
                <button class="btn btn-success" onclick="showSection('register')">íšŒì›ê°€ì…</button>
            </div>
             <div id="nav-user" class="nav-buttons hidden">
                <button class="btn btn-primary" onclick="showDashboardTab('orders')">ì£¼ë¬¸ í˜„í™©</button>
                <button class="btn btn-secondary" onclick="showDashboardTab('profile')">í”„ë¡œí•„ ìˆ˜ì •</button>
                <button class="btn btn-success" onclick="showDashboardTab('newOrder')">ìƒˆ ì£¼ë¬¸</button>
                <button class="btn btn-primary" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- í™ˆ ì„¹ì…˜ -->
        <div id="home-section" class="content">
            <h2>ğŸ¯ ì£¼ë¬¸ì œì‘ í”„ë¡œì„¸ìŠ¤</h2>
            <div class="grid-2">
                <div><h3>1ï¸âƒ£ íšŒì›ê°€ì…</h3><p>ê°œì¸ ë˜ëŠ” ì‚¬ì—…ìë¡œ ê°€ì…í•˜ì—¬ ì£¼ë¬¸ì„ ì‹œì‘í•˜ì„¸ìš”.</p></div>
                <div><h3>2ï¸âƒ£ ì£¼ë¬¸ ì ‘ìˆ˜</h3><p>ì›í•˜ëŠ” ì¹´ë“œ ì‚¬ì–‘ê³¼ ìˆ˜ëŸ‰ì„ ì„ íƒí•˜ê³  ì£¼ë¬¸ì„ ì ‘ìˆ˜í•©ë‹ˆë‹¤.</p></div>
                <div><h3>3ï¸âƒ£ ë””ìì¸ íŒŒì¼ ì „ì†¡</h3><p>ì£¼ë¬¸ ì™„ë£Œ í›„ ì•ˆë‚´ë˜ëŠ” ì´ë©”ì¼ë¡œ ë””ìì¸ íŒŒì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤.</p></div>
                <div><h3>4ï¸âƒ£ ì œì‘ ë° ë°°ì†¡</h3><p>ë§ˆì´í˜ì´ì§€ì—ì„œ ì‹¤ì‹œê°„ ì œì‘ í˜„í™©ì„ í™•ì¸í•˜ê³  ë°°ì†¡ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</p></div>
            </div>
        </div>

        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div id="login-section" class="content hidden">
            <h2>ğŸ” ë¡œê·¸ì¸</h2>
            <div id="login-alert"></div>
            <form id="loginForm">
                <div class="form-group"><label for="loginEmail">ì´ë©”ì¼</label><input type="email" id="loginEmail" required></div>
                <div class="form-group"><label for="loginPassword">ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="loginPassword" required></div>
                <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
            </form>
        </div>

        <!-- íšŒì›ê°€ì… ì„¹ì…˜ -->
        <div id="register-section" class="content hidden">
            <h2>ğŸ“ íšŒì›ê°€ì…</h2>
            <div id="register-alert"></div>
            <form id="registerForm">
                <div class="form-group"><label for="userType">íšŒì› ìœ í˜•</label><select id="userType" required onchange="toggleBusinessFields()"><option value="">ì„ íƒí•˜ì„¸ìš”</option><option value="individual">ê°œì¸</option><option value="business">ì‚¬ì—…ì</option></select></div>
                <div class="form-group"><label for="name">ì´ë¦„</label><input type="text" id="name" required></div>
                <div class="form-group"><label for="email">ì´ë©”ì¼</label><input type="email" id="email" required></div>
                <div class="form-group"><label for="password">ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="password" required></div>
                <div class="form-group"><label for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label><input type="password" id="confirmPassword" required></div>
                <div class="form-group"><label for="phone">íœ´ëŒ€í° ë²ˆí˜¸</label><input type="tel" id="phone" placeholder="010-0000-0000" required></div>
                <div class="form-group"><label for="address">ì£¼ì†Œ</label><input type="text" id="address" required></div>
                <div id="businessFields" class="business-fields hidden">
                    <h3>ì‚¬ì—…ì ì •ë³´</h3>
                    <div class="form-group"><label for="businessNumber">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label><input type="text" id="businessNumber" placeholder="000-00-00000"></div>
                    <div class="form-group"><label for="businessName">ìƒí˜¸ëª…</label><input type="text" id="businessName"></div>
                    <div class="form-group"><label for="businessAddress">ì‚¬ì—…ì¥ ì£¼ì†Œ</label><input type="text" id="businessAddress"></div>
                    <div class="form-group"><label for="businessPhone">ì‚¬ì—…ì¥ ì „í™”ë²ˆí˜¸</label><input type="tel" id="businessPhone" placeholder="ì§€ì—­ë²ˆí˜¸ í¬í•¨"></div>
                </div>
                <button type="submit" class="btn btn-success">ê°€ì…í•˜ê¸°</button>
            </form>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
        <div id="dashboard-section" class="content hidden">
            <!-- ëŒ€ì‹œë³´ë“œ íƒ­ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ í‘œì‹œ -->
        </div>

        <div id="loading" class="loading"><div class="spinner"></div><p>ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p></div>
    </div>

    <script>
        // [ì„¤ì •] - ì´ ë¶€ë¶„ì„ ë³¸ì¸ì˜ Google Apps Script ì›¹ ì•± URLë¡œ ë³€ê²½í•˜ì„¸ìš”.
        const GOOGLE_APPS_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';

        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;

        // --- ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        document.addEventListener('DOMContentLoaded', () => {
            checkLoginStatus();
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
        });

        // --- ì¸ì¦ ë° ì‚¬ìš©ì ê´€ë¦¬ ---
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateNav('user');
                showSection('dashboard');
                loadDashboard('orders');
            } else {
                updateNav('guest');
                showSection('home');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            showLoading(true);
            const loginData = {
                action: 'login',
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };
            const result = await apiCall(loginData);
            if (result.success) {
                currentUser = result.user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showAlert('login-alert', 'ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                setTimeout(() => {
                    document.getElementById('loginForm').reset();
                    checkLoginStatus();
                }, 1000);
            } else {
                showAlert('login-alert', result.message, 'error');
            }
            showLoading(false);
        }

        async function handleRegister(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            if (password !== confirmPassword) {
                showAlert('register-alert', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            showLoading(true);
            const registerData = {
                action: 'register',
                userType: document.getElementById('userType').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                password: password,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                businessNumber: document.getElementById('businessNumber').value,
                businessName: document.getElementById('businessName').value,
                businessAddress: document.getElementById('businessAddress').value,
                businessPhone: document.getElementById('businessPhone').value,
            };
            const result = await apiCall(registerData);
            if (result.success) {
                showAlert('register-alert', 'íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'success');
                setTimeout(() => {
                    document.getElementById('registerForm').reset();
                    showSection('login');
                }, 2000);
            } else {
                showAlert('register-alert', result.message, 'error');
            }
            showLoading(false);
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            checkLoginStatus();
        }

        // --- API í†µì‹  ---
        async function apiCall(data) {
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    redirect: 'follow',
                    body: JSON.stringify(data),
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }
                });
                return await response.json();
            } catch (error) {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                return { success: false, message: 'ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' };
            }
        }

        // --- UI ë Œë”ë§ ë° ì œì–´ ---
        function showSection(sectionName) {
            document.querySelectorAll('.content').forEach(s => s.classList.add('hidden'));
            const section = document.getElementById(`${sectionName}-section`);
            if (section) section.classList.remove('hidden');
        }

        function updateNav(type) {
            document.getElementById('nav-guest').classList.toggle('hidden', type === 'user');
            document.getElementById('nav-user').classList.toggle('hidden', type === 'guest');
        }
        
        function toggleBusinessFields() {
            const userType = document.getElementById('userType').value;
            document.getElementById('businessFields').classList.toggle('hidden', userType !== 'business');
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            loading.style.display = show ? 'flex' : 'none';
        }

        function showAlert(elementId, message, type) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => { alertDiv.innerHTML = ''; }, 4000);
        }

        // --- ëŒ€ì‹œë³´ë“œ ê´€ë ¨ í•¨ìˆ˜ ---
        function loadDashboard(activeTab = 'orders') {
            const dashboardSection = document.getElementById('dashboard-section');
            dashboardSection.innerHTML = `<h2>ğŸ“Š ë§ˆì´í˜ì´ì§€: ${currentUser.name}ë‹˜</h2>`;
            showDashboardTab(activeTab);
        }

        function showDashboardTab(tabName) {
            showSection('dashboard');
            const dashboardSection = document.getElementById('dashboard-section');
            
            // ê¸°ì¡´ íƒ­ ë‚´ìš© ì œê±°
            const existingTab = dashboardSection.querySelector('.dashboard-tab-content');
            if (existingTab) existingTab.remove();
            
            let tabContent = document.createElement('div');
            tabContent.className = 'dashboard-tab-content';

            if (tabName === 'orders') tabContent.innerHTML = getOrdersHTML();
            else if (tabName === 'profile') tabContent.innerHTML = getProfileHTML();
            else if (tabName === 'newOrder') tabContent.innerHTML = getNewOrderHTML();
            
            dashboardSection.appendChild(tabContent);

            if (tabName === 'orders') loadOrders();
            else if (tabName === 'profile') {
                loadProfile();
                document.getElementById('profileForm').addEventListener('submit', handleProfileUpdate);
            }
            else if (tabName === 'newOrder') {
                document.getElementById('orderForm').addEventListener('submit', handleNewOrder);
            }
        }
        
        function getOrdersHTML() { return `<h3>ğŸ“¦ ì£¼ë¬¸ í˜„í™©</h3><div id="ordersList"></div>`; }
        function getProfileHTML() { return `<h3>ğŸ‘¤ í”„ë¡œí•„ ìˆ˜ì •</h3><div id="profile-alert"></div><form id="profileForm"><div class="form-group"><label for="profileName">ì´ë¦„</label><input type="text" id="profileName" required></div><div class="form-group"><label for="profilePhone">íœ´ëŒ€í° ë²ˆí˜¸</label><input type="tel" id="profilePhone" required></div><div class="form-group"><label for="profileAddress">ì£¼ì†Œ</label><input type="text" id="profileAddress" required></div><button type="submit" class="btn btn-primary">ìˆ˜ì •í•˜ê¸°</button></form>`; }
        function getNewOrderHTML() { return `<h3>ğŸ›’ ìƒˆ ì£¼ë¬¸</h3><div class="file-upload-notice"><strong>ğŸ“§ ë””ìì¸ íŒŒì¼ ì•ˆë‚´</strong><br>ì£¼ë¬¸ ì™„ë£Œ í›„ ë””ìì¸ íŒŒì¼(ì¼ëŸ¬ìŠ¤íŠ¸ ë“±)ì„ ì´ë©”ì¼ë¡œ ì „ì†¡í•´ì£¼ì„¸ìš”.<br>ì´ë©”ì¼: youngcardin@hanmail.net</div><div id="order-alert"></div><form id="orderForm"><div class="form-group"><label for="cardType">ì¹´ë“œ íƒ€ì…</label><select id="cardType" required><option value="">ì„ íƒí•˜ì„¸ìš”</option><option value="pvc-standard">PVC í‘œì¤€ (0.76mm)</option><option value="pvc-premium">PVC í”„ë¦¬ë¯¸ì—„ (0.84mm)</option><option value="pvc-magnetic">PVC ë§ˆê·¸ë„¤í‹±</option></select></div><div class="form-group"><label for="quantity">ìˆ˜ëŸ‰</label><input type="number" id="quantity" min="100" required></div><div class="form-group"><label for="orderNotes">ì£¼ë¬¸ ìš”ì²­ì‚¬í•­</label><textarea id="orderNotes" rows="4" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea></div><button type="submit" class="btn btn-success">ì£¼ë¬¸í•˜ê¸°</button></form>`; }

        async function loadOrders() {
            showLoading(true);
            const result = await apiCall({ action: 'getOrders', userId: currentUser.id });
            const ordersList = document.getElementById('ordersList');
            if (result.success && result.orders.length > 0) {
                ordersList.innerHTML = result.orders.map(order => `
                    <div class="status-item">
                        <div>
                            <strong>ì£¼ë¬¸ë²ˆí˜¸: ${order.id}</strong><br>
                            <span>${order.cardType} - ${order.quantity}ë§¤</span><br>
                            <small>ì£¼ë¬¸ì¼: ${new Date(order.orderDate).toLocaleDateString()}</small>
                        </div>
                        <div class="status-badge status-${order.status}">
                            ${{pending:'ì ‘ìˆ˜ ëŒ€ê¸°', processing:'ì œì‘ ì¤‘', shipping:'ë°°ì†¡ ì¤‘', completed:'ì™„ë£Œ'}[order.status]}
                        </div>
                    </div>
                `).join('');
            } else {
                ordersList.innerHTML = '<p>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            showLoading(false);
        }

        function loadProfile() {
            document.getElementById('profileName').value = currentUser.name || '';
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileAddress').value = currentUser.address || '';
        }

        async function handleProfileUpdate(e) {
            e.preventDefault();
            showLoading(true);
            const profileData = {
                action: 'updateProfile',
                userId: currentUser.id,
                name: document.getElementById('profileName').value,
                phone: document.getElementById('profilePhone').value,
                address: document.getElementById('profileAddress').value
            };
            const result = await apiCall(profileData);
            if (result.success) {
                currentUser.name = profileData.name;
                currentUser.phone = profileData.phone;
                currentUser.address = profileData.address;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showAlert('profile-alert', 'í”„ë¡œí•„ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                loadDashboard('profile'); // ìˆ˜ì •ëœ ì •ë³´ë¡œ ëŒ€ì‹œë³´ë“œ í—¤ë”ë„ ê°±ì‹ 
            } else {
                showAlert('profile-alert', result.message, 'error');
            }
            showLoading(false);
        }

        async function handleNewOrder(e) {
            e.preventDefault();
            showLoading(true);
            const orderData = {
                action: 'newOrder',
                userId: currentUser.id,
                cardType: document.getElementById('cardType').value,
                quantity: parseInt(document.getElementById('quantity').value),
                notes: document.getElementById('orderNotes').value,
            };
            const result = await apiCall(orderData);
            if (result.success) {
                showAlert('order-alert', 'ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤! ë””ìì¸ íŒŒì¼ì„ ì´ë©”ì¼ë¡œ ì „ì†¡í•´ì£¼ì„¸ìš”.', 'success');
                setTimeout(() => showDashboardTab('orders'), 2000);
            } else {
                showAlert('order-alert', result.message, 'error');
            }
            showLoading(false);
        }
    </script>
</body>
</html>
