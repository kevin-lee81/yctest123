<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프리미엄 PVC 카드 주문제작</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap">
    <style>/* 이전과 동일한 CSS 코드 */</style>
</head>
<body>
    <div id="loading" class="loading hidden"><div class="spinner"></div></div>

    <header class="header container">
        <div class="logo" onclick="showPage('home')">CARD-PRO</div>
        <div id="nav-guest" class="nav-buttons">
            <button class="btn btn-outline-primary" onclick="showPage('login')">로그인</button>
            <button class="btn btn-primary" onclick="showPage('register')">회원가입</button>
        </div>
        <div id="nav-user" class="nav-buttons hidden">
            <span id="user-greeting" style="margin-right: 1rem; align-self: center;"></span>
            <button class="btn btn-outline-primary" onclick="showPage('dashboard')">마이페이지</button>
            <button class="btn btn-primary" onclick="logout()">로그아웃</button>
        </div>
    </header>

    <main class="container">
        <!-- 홈 섹션 -->
        <section id="home-page" class="page-section"></section>
        <!-- 로그인 섹션 -->
        <section id="login-page" class="page-section"></section>
        <!-- 회원가입 섹션 -->
        <section id="register-page" class="page-section"></section>
        <!-- 대시보드 섹션 -->
        <section id="dashboard-page" class="page-section"></section>
    </main>

    <script>
        // --- 설정 ---
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwbVTXteGOD4aTzmBXrbktgJDu77rhYCtqBdmwoS0D2tN1W7JYhKnnhcrslFOHAf1URpw/exec'; // ⚠️ 본인의 웹 앱 URL로 교체!

        // --- 전역 변수 및 초기화 ---
        let currentUser = null;
        const loadingEl = document.getElementById('loading');
        
        document.addEventListener('DOMContentLoaded', () => {
            renderHomePage();
            renderLoginPage();
            renderRegisterPage();
            checkLoginStatus();
        });

        // --- API 통신 ---
        async function apiCall(data) {
            showLoading(true);
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST', mode: 'cors', redirect: 'follow',
                    body: JSON.stringify(data),
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }
                });
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, message: '서버와 통신 중 오류가 발생했습니다. 개발자 콘솔(F12)을 확인해주세요.' };
            } finally {
                showLoading(false);
            }
        }

        // --- 페이지 및 네비게이션 제어 ---
        function showPage(pageName) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`${pageName}-page`).classList.add('active');
            if (pageName === 'dashboard') {
                renderDashboardPage('orders');
            }
        }

        function updateNav(isLoggedIn) {
            document.getElementById('nav-guest').classList.toggle('hidden', isLoggedIn);
            document.getElementById('nav-user').classList.toggle('hidden', !isLoggedIn);
            if (isLoggedIn) {
                document.getElementById('user-greeting').textContent = `${currentUser.name}님`;
            }
        }
        
        // --- 렌더링 함수들 ---
        function renderHomePage() {
            document.getElementById('home-page').innerHTML = `
                <div class="hero">
                    <h1>최고의 퀄리티, 당신만의 PVC 카드</h1>
                    <p>신분증, 회원카드, 기프트카드 등 모든 종류의 PVC 카드를 전문적으로 제작합니다.</p>
                    <button class="btn btn-primary" id="startOrderBtn">견적 / 주문 시작하기</button>
                </div>`;
            document.getElementById('startOrderBtn').onclick = () => {
                if (currentUser) showPage('dashboard');
                else {
                    showPage('login');
                    showAlert('login-alert', '주문을 하시려면 먼저 로그인해주세요.', 'danger');
                }
            };
        }
        function renderLoginPage() {
             document.getElementById('login-page').innerHTML = `
                <div class="auth-container">
                    <h2>로그인</h2>
                    <div id="login-alert"></div>
                    <form id="loginForm">
                        <div class="form-group"><label for="loginEmail">이메일</label><input type="email" id="loginEmail" class="form-control" required></div>
                        <div class="form-group"><label for="loginPassword">비밀번호</label><input type="password" id="loginPassword" class="form-control" required></div>
                        <button type="submit" class="btn btn-primary w-100">로그인</button>
                    </form>
                </div>`;
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        }
        function renderRegisterPage() {
             document.getElementById('register-page').innerHTML = `
                <div class="auth-container">
                    <h2>회원가입</h2>
                    <div id="register-alert"></div>
                    <form id="registerForm">
                        <div class="form-group"><label for="userType">회원 유형</label><select id="userType" class="form-control" required><option value="">선택</option><option value="individual">개인</option><option value="business">사업자</option></select></div>
                        <div class="form-group"><label for="name">이름</label><input type="text" id="name" class="form-control" required></div>
                        <div class="form-group"><label for="email">이메일</label><input type="email" id="email" class="form-control" required></div>
                        <div class="form-group"><label for="password">비밀번호</label><input type="password" id="password" class="form-control" required></div>
                        <div class="form-group"><label for="confirmPassword">비밀번호 확인</label><input type="password" id="confirmPassword" class="form-control" required></div>
                        <div class="form-group"><label for="phone">휴대폰 번호</label><input type="tel" id="phone" class="form-control" required></div>
                        <div class="form-group"><label for="address">주소</label><input type="text" id="address" class="form-control" required></div>
                        <div id="businessFields" class="hidden" style="background: #f8f9fa; padding: 1rem; border-radius: 0.3rem;"><h3 style="margin:0 0 1rem;font-size:1.1rem;">사업자 정보</h3><div class="form-group"><label for="businessNumber">사업자등록번호</label><input type="text" id="businessNumber" class="form-control"></div><div class="form-group"><label for="businessName">상호명</label><input type="text" id="businessName" class="form-control"></div></div>
                        <button type="submit" class="btn btn-primary w-100">가입하기</button>
                    </form>
                </div>`;
            document.getElementById('userType').onchange = () => document.getElementById('businessFields').classList.toggle('hidden', document.getElementById('userType').value !== 'business');
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
        }
        
        function renderDashboardPage(activeTab) {
            const dashboardEl = document.getElementById('dashboard-page');
            dashboardEl.innerHTML = `
                <div class="dashboard">
                    <nav class="dashboard-nav">
                        <a href="#" class="nav-link" data-tab="orders">주문 현황</a>
                        <a href="#" class="nav-link" data-tab="newOrder">새 주문</a>
                        <a href="#" class="nav-link" data-tab="profile">프로필 수정</a>
                    </nav>
                    <div class="dashboard-content">
                        <div id="orders-tab" class="dashboard-tab"></div>
                        <div id="newOrder-tab" class="dashboard-tab"></div>
                        <div id="profile-tab" class="dashboard-tab"></div>
                    </div>
                </div>`;
            document.querySelectorAll('.dashboard-nav .nav-link').forEach(link => {
                link.onclick = (e) => { e.preventDefault(); renderDashboardPage(e.target.dataset.tab); };
            });
            
            // Activate Tab
            document.querySelector(`.dashboard-nav .nav-link[data-tab="${activeTab}"]`).classList.add('active');
            document.getElementById(`${activeTab}-tab`).classList.add('active');

            // Render Tab Content
            if (activeTab === 'orders') renderOrdersTab();
            else if (activeTab === 'newOrder') renderNewOrderTab();
            else if (activeTab === 'profile') renderProfileTab();
        }

        async function renderOrdersTab() {
            const container = document.getElementById('orders-tab');
            container.innerHTML = '<h3>주문 현황</h3><p>로딩 중...</p>';
            const result = await apiCall({ action: 'getOrders', userId: currentUser.id });
            if (result.success && result.orders.length > 0) {
                container.innerHTML = '<h3>주문 현황</h3>' + result.orders.map(o => `
                    <div class="order-item">
                        <div class="order-header">
                            <span class="order-id">주문번호: ${o.id}</span>
                            <span class="status-badge status-${o.status}">${{pending:'접수대기',processing:'제작중',shipping:'배송중',completed:'완료'}[o.status]}</span>
                        </div>
                        <p><strong>카드타입:</strong> ${o.cardType} / <strong>수량:</strong> ${o.quantity}매</p>
                        <p><small>주문일: ${new Date(o.orderDate).toLocaleDateString()}</small></p>
                    </div>`).join('');
            } else {
                container.innerHTML = '<h3>주문 현황</h3><p>주문 내역이 없습니다.</p>';
            }
        }
        
        function renderNewOrderTab() { /* 이전 답변의 로직과 동일 */ }
        function renderProfileTab() { /* 이전 답변의 로직과 동일 */ }

        // --- 핸들러 함수들 ---
        async function handleLogin(e) { /* 이전 답변의 로직과 동일 */ }
        async function handleRegister(e) { /* 이전 답변의 로직과 동일 */ }
        function logout() { /* 이전 답변의 로직과 동일 */ }
        async function handleNewOrder(e) { /* 이전 답변의 로직과 동일 */ }
        async function handleProfileUpdate(e) { /* 이전 답변의 로직과 동일 */ }

        // --- 유틸리티 함수 ---
        function showLoading(show) { loadingEl.classList.toggle('hidden', !show); }
        function showAlert(id, msg, type) { /* 이전 답변의 로직과 동일 */ }
    </script>
</body>
</html>
