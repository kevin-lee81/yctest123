<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프리미엄 PVC 카드 주문제작</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap">
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --bg-light: #f8f9fa;
            --border-color: #dee2e6;
            --text-dark: #212529;
            --text-light: #6c757d;
        }
        *, *::before, *::after { box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            background-color: #fff;
            color: var(--text-dark);
            line-height: 1.6;
        }
        .container { max-width: 1140px; margin: 0 auto; padding: 0 15px; }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        .logo { font-size: 1.5rem; font-weight: 700; text-decoration: none; color: var(--text-dark); cursor: pointer; }
        .nav-buttons .btn { margin-left: 0.5rem; }
        .btn {
            display: inline-block; padding: 0.6rem 1.2rem; font-size: 1rem; font-weight: 500;
            text-align: center; text-decoration: none; cursor: pointer; border-radius: 0.3rem;
            transition: all 0.2s; border: 1px solid transparent;
        }
        .btn-primary { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .btn-primary:hover { background-color: #0b5ed7; }
        .btn-outline-primary { color: var(--primary-color); border-color: var(--primary-color); }
        .btn-outline-primary:hover { background-color: var(--primary-color); color: white; }
        .w-100 { width: 100%; }

        main { padding: 4rem 0; }
        .page-section { display: none; }
        .page-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .hero { text-align: center; padding: 4rem 0; }
        .hero h1 { font-size: 3rem; font-weight: 700; margin-bottom: 1rem; }
        .hero p { font-size: 1.25rem; color: var(--text-light); margin-bottom: 2rem; max-width: 700px; margin-left: auto; margin-right: auto; }
        .hero .btn { padding: 1rem 2rem; font-size: 1.25rem; }

        .auth-container { max-width: 480px; margin: 2rem auto; padding: 2.5rem; background-color: #fff; border: 1px solid var(--border-color); border-radius: 0.5rem; }
        .auth-container h2 { text-align: center; margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-control {
            width: 100%; padding: 0.75rem; font-size: 1rem; border: 1px solid var(--border-color);
            border-radius: 0.3rem;
        }
        .form-control:focus { outline: 0; border-color: var(--primary-color); box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); }
        
        .dashboard { display: flex; gap: 2rem; }
        .dashboard-nav { flex: 0 0 220px; }
        .dashboard-nav .nav-link {
            display: block; padding: 0.75rem 1rem; text-decoration: none; color: var(--text-dark);
            border-radius: 0.3rem; margin-bottom: 0.5rem; cursor: pointer;
        }
        .dashboard-nav .nav-link.active, .dashboard-nav .nav-link:hover { background-color: var(--bg-light); color: var(--primary-color); }
        .dashboard-content { flex-grow: 1; }
        .dashboard-tab { display: none; }
        .dashboard-tab.active { display: block; animation: fadeIn 0.5s; }
        .dashboard-tab h3 { margin-top: 0; margin-bottom: 1.5rem; }

        .order-item { border: 1px solid var(--border-color); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem; }
        .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem; }
        .order-id { font-weight: 700; }
        .status-badge { padding: 0.3em 0.7em; font-size: 0.8em; border-radius: 1rem; color: white; }
        .status-pending { background-color: var(--warning-color); }
        .status-processing { background-color: var(--primary-color); }
        .status-shipping { background-color: #6f42c1; }
        .status-completed { background-color: var(--success-color); }
        
        .alert { padding: 1rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: 0.3rem; }
        .alert-success { color: #0f5132; background-color: #d1e7dd; border-color: #badbcc; }
        .alert-danger { color: #842029; background-color: #f8d7da; border-color: #f5c2c7; }

        .hidden { display: none; }
        .loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.8); display: flex;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="loading" class="loading hidden"><div class="spinner"></div></div>

    <header class="header container">
        <div class="logo" onclick="showPage('home')">CARD-PRO</div>
        <div id="nav-guest" class="nav-buttons">
            <button class="btn btn-outline-primary" onclick="showPage('login')">로그인</button>
            <button class="btn btn-primary" onclick="showPage('register')">회원가입</button>
        </div>
        <div id="nav-user" class="nav-buttons hidden">
            <span id="user-greeting" style="margin-right: 1rem; align-self: center;"></span>
            <button class="btn btn-outline-primary" onclick="showPage('dashboard')">마이페이지</button>
            <button class="btn btn-primary" onclick="logout()">로그아웃</button>
        </div>
    </header>

    <main class="container">
        <!-- 홈 섹션 -->
        <section id="home-page" class="page-section">
            <div class="hero">
                <h1>최고의 퀄리티, 당신만의 PVC 카드</h1>
                <p>신분증, 회원카드, 기프트카드 등 모든 종류의 PVC 카드를 전문적으로 제작합니다.</p>
                <button class="btn btn-primary" onclick="startOrder()">견적 / 주문 시작하기</button>
            </div>
        </section>

        <!-- 로그인 섹션 -->
        <section id="login-page" class="page-section">
            <div class="auth-container">
                <h2>로그인</h2>
                <div id="login-alert"></div>
                <form id="loginForm">
                    <div class="form-group"><label for="loginEmail">이메일</label><input type="email" id="loginEmail" class="form-control" required></div>
                    <div class="form-group"><label for="loginPassword">비밀번호</label><input type="password" id="loginPassword" class="form-control" required></div>
                    <button type="submit" class="btn btn-primary w-100">로그인</button>
                </form>
            </div>
        </section>

        <!-- 회원가입 섹션 -->
        <section id="register-page" class="page-section">
            <div class="auth-container">
                <h2>회원가입</h2>
                <div id="register-alert"></div>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="userType">회원 유형</label>
                        <select id="userType" class="form-control" required onchange="toggleBusinessFields()">
                            <option value="">선택하세요</option>
                            <option value="individual">개인</option>
                            <option value="business">사업자</option>
                        </select>
                    </div>
                    <div class="form-group"><label for="name">이름</label><input type="text" id="name" class="form-control" required></div>
                    <div class="form-group"><label for="email">이메일</label><input type="email" id="email" class="form-control" required></div>
                    <div class="form-group"><label for="password">비밀번호</label><input type="password" id="password" class="form-control" required></div>
                    <div class="form-group"><label for="confirmPassword">비밀번호 확인</label><input type="password" id="confirmPassword" class="form-control" required></div>
                    <div class="form-group"><label for="phone">휴대폰 번호</label><input type="tel" id="phone" class="form-control" placeholder="010-0000-0000" required></div>
                    <div class="form-group"><label for="address">주소</label><input type="text" id="address" class="form-control" required></div>
                    <div id="businessFields" class="hidden" style="background: #f8f9fa; padding: 1rem; border-radius: 0.3rem;">
                        <h3 style="margin-top:0; margin-bottom:1rem; font-size: 1.1rem;">사업자 정보</h3>
                        <div class="form-group"><label for="businessNumber">사업자등록번호</label><input type="text" id="businessNumber" class="form-control" placeholder="000-00-00000"></div>
                        <div class="form-group"><label for="businessName">상호명</label><input type="text" id="businessName" class="form-control"></div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">가입하기</button>
                </form>
            </div>
        </section>
        
        <!-- 대시보드 섹션 -->
        <section id="dashboard-page" class="page-section">
            <div class="dashboard">
                <nav class="dashboard-nav">
                    <a href="#" class="nav-link active" data-tab="orders" onclick="showDashboardTab(event)">주문 현황</a>
                    <a href="#" class="nav-link" data-tab="newOrder" onclick="showDashboardTab(event)">새 주문</a>
                    <a href="#" class="nav-link" data-tab="profile" onclick="showDashboardTab(event)">프로필 수정</a>
                </nav>
                <div class="dashboard-content">
                    <div id="orders-tab" class="dashboard-tab"></div>
                    <div id="newOrder-tab" class="dashboard-tab"></div>
                    <div id="profile-tab" class="dashboard-tab"></div>
                </div>
            </div>
        </section>
    </main>
    <script>
        // --- 설정 ---
        const GOOGLE_APPS_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'; // ⚠️ 본인의 웹 앱 URL로 교체!

        // --- 전역 변수 및 초기화 ---
        let currentUser = null;
        const loadingEl = document.getElementById('loading');

        document.addEventListener('DOMContentLoaded', () => {
            checkLoginStatus();
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
        });

        // --- 페이지 및 네비게이션 제어 ---
        function showPage(pageName) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`${pageName}-page`).classList.add('active');
            if (pageName === 'dashboard') {
                renderDashboard('orders');
            }
        }

        function updateNav(isLoggedIn) {
            document.getElementById('nav-guest').classList.toggle('hidden', isLoggedIn);
            document.getElementById('nav-user').classList.toggle('hidden', !isLoggedIn);
            if (isLoggedIn) {
                document.getElementById('user-greeting').textContent = `${currentUser.name}님, 안녕하세요.`;
            }
        }

        function toggleBusinessFields() {
            document.getElementById('businessFields').classList.toggle('hidden', document.getElementById('userType').value !== 'business');
        }

        function startOrder() {
            if (currentUser) {
                showPage('dashboard');
                renderDashboard('newOrder');
            } else {
                showPage('login');
                showAlert('login-alert', '주문을 하시려면 먼저 로그인해주세요.', 'danger');
            }
        }
        
        // --- 인증 관련 (로그인, 회원가입, 로그아웃) ---
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateNav(true);
                showPage('home');
            } else {
                updateNav(false);
                showPage('home');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            showLoading(true);
            const result = await apiCall({
                action: 'login',
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            });
            showLoading(false);
            if (result.success) {
                currentUser = result.user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                document.getElementById('loginForm').reset();
                checkLoginStatus();
                showPage('dashboard');
                renderDashboard('orders');
            } else {
                showAlert('login-alert', result.message, 'danger');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            if (password !== document.getElementById('confirmPassword').value) {
                showAlert('register-alert', '비밀번호가 일치하지 않습니다.', 'danger');
                return;
            }
            showLoading(true);
            const result = await apiCall({
                action: 'register',
                userType: document.getElementById('userType').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                password: password,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                businessNumber: document.getElementById('businessNumber').value,
                businessName: document.getElementById('businessName').value,
            });
            showLoading(false);
            if (result.success) {
                showAlert('register-alert', '회원가입 성공! 로그인 페이지로 이동합니다.', 'success');
                setTimeout(() => showPage('login'), 2000);
            } else {
                showAlert('register-alert', result.message, 'danger');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            checkLoginStatus();
        }

        // --- API 통신 ---
        async function apiCall(data) {
            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST', mode: 'cors', redirect: 'follow',
                    body: JSON.stringify(data),
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }
                });
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, message: '서버와 통신 중 오류가 발생했습니다.' };
            }
        }

        // --- 대시보드 관련 ---
        function renderDashboard(activeTab) {
            document.querySelectorAll('.dashboard-nav .nav-link').forEach(link => {
                link.classList.toggle('active', link.dataset.tab === activeTab);
            });
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.classList.toggle('active', tab.id === `${activeTab}-tab`);
            });

            if (activeTab === 'orders') renderOrdersTab();
            else if (activeTab === 'newOrder') renderNewOrderTab();
            else if (activeTab === 'profile') renderProfileTab();
        }
        
        function showDashboardTab(event) {
            event.preventDefault();
            renderDashboard(event.target.dataset.tab);
        }

        async function renderOrdersTab() {
            const container = document.getElementById('orders-tab');
            container.innerHTML = '<h3>주문 현황</h3><p>주문 내역을 불러오는 중...</p>';
            const result = await apiCall({ action: 'getOrders', userId: currentUser.id });
            if (result.success && result.orders.length > 0) {
                container.innerHTML = '<h3>주문 현황</h3>' + result.orders.map(order => `
                    <div class="order-item">
                        <div class="order-header">
                            <span class="order-id">주문번호: ${order.id}</span>
                            <span class="status-badge status-${order.status}">${{pending:'접수 대기', processing:'제작 중', shipping:'배송 중', completed:'완료'}[order.status]}</span>
                        </div>
                        <div><strong>카드타입:</strong> ${order.cardType}</div>
                        <div><strong>수량:</strong> ${order.quantity}매</div>
                        <div><strong>주문일:</strong> ${new Date(order.orderDate).toLocaleDateString()}</div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<h3>주문 현황</h3><p>주문 내역이 없습니다.</p>';
            }
        }

        function renderNewOrderTab() {
            const container = document.getElementById('newOrder-tab');
            container.innerHTML = `
                <h3>새 주문</h3>
                <div class="alert alert-success" style="background-color: #e2f0fe; color: #084298; border-color: #b6d4fe;">
                    <strong>디자인 파일 안내:</strong> 주문 완료 후 디자인 파일(일러스트 등)을 이메일로 전송해주세요. (your-email@company.com)
                </div>
                <div id="order-alert"></div>
                <form id="orderForm">
                    <!-- 새 주문 폼 HTML (이전과 동일) -->
                    <button type="submit" class="btn btn-primary w-100">주문하기</button>
                </form>
            `;
            document.getElementById('orderForm').addEventListener('submit', handleNewOrder);
        }
        
        function renderProfileTab() {
            const container = document.getElementById('profile-tab');
            container.innerHTML = `
                <h3>프로필 수정</h3>
                <div id="profile-alert"></div>
                <form id="profileForm">
                    <!-- 프로필 폼 HTML (이전과 동일, currentUser 정보로 채움) -->
                    <button type="submit" class="btn btn-primary w-100">수정하기</button>
                </form>
            `;
            // 폼 필드에 현재 사용자 정보 채우기
            document.getElementById('profileName').value = currentUser.name;
            // ... 다른 필드들도 채우기
            document.getElementById('profileForm').addEventListener('submit', handleProfileUpdate);
        }

        async function handleNewOrder(e) {
            e.preventDefault();
            // 새 주문 처리 로직
        }
        
        async function handleProfileUpdate(e) {
            e.preventDefault();
            // 프로필 업데이트 로직
        }

        // --- 유틸리티 함수 ---
        function showLoading(show) {
            loadingEl.classList.toggle('hidden', !show);
        }
        
        function showAlert(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => el.innerHTML = '', 4000);
        }

    </script>
</body>
</html>
